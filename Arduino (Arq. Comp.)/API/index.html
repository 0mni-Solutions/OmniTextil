<!DOCTYPE html>
<html>
  <head>
    <title>Line Chart</title>
    <link rel="stylesheet" href="css/style.css" />
    <link id="link_theme" rel="stylesheet" href="css/theme_dark.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
      canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
    </style>
  </head>

  <body>
    <header class="header dash-header">
      <div class="container">
        <a href="index.html" class="href-title">
          <img
            src="assets/imgs/header-footer/logo-OMNI_Textil.png"
            alt="OMNI TÊXTIL"
          />
        </a>
        <!-- ALTERAR A CLASSE EM DETERMINADAS PÁGINAS -->
        <ul class="navbar-header">
          <li class="">Unidades</li>
          <hr />
          <li class="" id="li_cadastro">Cadastro</li>
          <hr id="hr_cadastro" />
          <li class="">Sair</a>
          </li>
          <img
            id="img_theme"
            onclick="theme_change()"
            src="assets/imgs/header-footer/sun_on.png"
            title="Mudar tema"
            alt="Sol do Tema"
          />
        </ul>
      </div>
    </header>
    <div>
      <!-- <h1>Sensor DHT 11 - Umidade</h1>
        <section style="width:100%">
            <canvas id="dht11Umidade"></canvas>
        </section>
        <h1>Sensor DHT 11 - Temperatura</h1>
        <section style="width: 100%;">
            <canvas id="dht11Temperatura"></canvas>
        </section> -->

      <div class="banner-dash">
        <!-- SECTION 1 -->
        <div class="section sec1 dash-sec1">
          <div class="container">
            <div class="dash-label dash-umi">
              <h1>UMIDADE</h1>
              <hr />
            </div>
            <div class="div-graphs">
              <div class="div-linechart chart-umidade">
                <canvas id="dht11Umidade"></canvas>
              </div>
              <div class="div-side-graphs">
                <div class="div-kpi">
                  <div class="div-dougchart chart-umidade kpi-now">
                    <div class="kpi-title">TEMPO REAL</div>
                    <div class="kpi-data">51,5%</div>
                  </div>
                  <div class="div-dougchart chart-umidade">
                    <canvas id="UMI_ChartDOUG"></canvas>
                  </div>
                </div>
                <div class="div-barchart chart-umidade">
                  <canvas id="UMI_ChartBAR"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- SECTION 2 -->
        <div class="section sec2 dash-sec2">
          <div class="container">
            <div class="dash-label dash-temp">
              <h1>TEMPERATURA</h1>
              <hr />
            </div>
            <div class="div-graphs graph-temp">
              <div class="div-linechart chart-temperatura">
                <canvas id="dht11Temperatura"></canvas>
              </div>
              <div class="div-side-graphs">
                <div class="div-kpi">
                  <div class="div-dougchart chart-temperatura kpi-now">
                    <div class="kpi-title">TEMPO REAL</div>
                    <div class="kpi-data">17,0ºC</div>
                  </div>
                  <div class="div-dougchart chart-temperatura">
                    <canvas id="TEMP_ChartDOUG"></canvas>
                  </div>
                </div>
                <div class="div-barchart chart-temperatura">
                  <canvas id="TEMP_ChartBAR"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <!-- BOX DE REPORT -->
        <div class="box reports">
          <img src="assets/imgs/header-footer/logo_lupa.png" alt="lupa" />
          <p>
            Feedbacks<br />
            Reports
          </p>
        </div>
        <!-- BOX DE CONTATO -->
        <div class="box contato">
          <h4>Contato</h4>
          <hr />
          <h5>
            <img
              src="assets/imgs/header-footer/logo_whats.png"
              alt="whats"
            />(011)2534-1484
          </h5>
          <h5>
            <img
              src="assets/imgs/header-footer/logo_email.png"
              alt="email"
            />omnisuport@solution.com
          </h5>
        </div>
        <!-- BOX DA OMNI SOLUTIONS -->
        <div class="box">
          <h2>OMNI Solution</h2>
        </div>
      </div>
    </footer>

    <script>
      /* -- dht11Umidade -- */
      // var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
      // contextoDht11Umidade.canvas.width = 1000;
      // contextoDht11Umidade.canvas.height = 300;
      // var dht11Umidade = new Chart(
      //     contextoDht11Umidade,
      //     {
      //         type: 'line',
      //         data: {
      //             datasets: [{
      //                 label: 'Umidade',
      //                 type: 'line',
      //                 borderColor: ['#45b3e7'],
      //                 backgroundColor: ['#89cff0']
      //             }]
      //         },
      //         options: {
      //             scales: {
      //                 xAxes: [{
      //                     distribution: 'series',
      //                     ticks: {
      //                         beginAtZero: true
      //                     }
      //                 }],
      //                 yAxes: [{
      //                     scaleLabel: {
      //                         display: true,
      //                         labelString: 'Umidade'
      //                     },
      //                     ticks: {
      //                         beginAtZero: true
      //                     }
      //                 }]
      //             },
      //             animation: {
      //                 duration: 0
      //             }
      //         }
      //     }
      // );
      /* -- dht11Temperatura -- */
      // var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
      // contextoDht11Temperatura.canvas.width = 1000;
      // contextoDht11Temperatura.canvas.height = 300;
      // var dht11Temperatura = new Chart(
      //     contextoDht11Temperatura,
      //     {
      //         type: 'line',
      //         data: {
      //             datasets: [{
      //                 label: "Temperatura",
      //                 type: 'line',
      //                 borderColor: ['#ff3232'],
      //                 backgroundColor: ['#ff7f7f']
      //             }]
      //         },
      //         options: {
      //             scales: {
      //                 xAxes: [{
      //                     distribution: 'series',
      //                     ticks: {
      //                         beginAtZero: true
      //                     }
      //                 }],
      //                 yAxes: [{
      //                     scaleLabel: {
      //                         display: true,
      //                         labelString: 'Luminosidade'
      //                     },
      //                     ticks: {
      //                         beginAtZero: true
      //                     }
      //                 }]
      //             },
      //             animation: {
      //                 duration: 0
      //             }
      //         }
      //     }
      // );

      var paginacao = {};
      var tempo = {};
      function obterDados(grafico, endpoint) {
        var http = new XMLHttpRequest();
        http.open("GET", "http://localhost:3000/sensores/" + endpoint, false);
        http.send(null);
        var valores = JSON.parse(http.responseText);
        if (paginacao[endpoint] == null) {
          paginacao[endpoint] = 0;
        }
        if (tempo[endpoint] == null) {
          tempo[endpoint] = 0;
        }
        // Exibir à partir do último elemento exibido anteriormente
        var ultimaPaginacao = paginacao[endpoint];
        paginacao[endpoint] = valores.length;
        var valores = valores.slice(ultimaPaginacao);
        valores.forEach((valor) => {
          //Máximo de 60 itens exibidos no gráfico
          if (
            grafico.data.labels.length == 10 &&
            grafico.data.datasets[0].data.length == 10
          ) {
            grafico.data.labels.shift();
            grafico.data.datasets[0].data.shift();
          }

          grafico.data.labels.push(tempo[endpoint]++);
          grafico.data.datasets[0].data.push(parseFloat(valor));
          grafico.update();
        });
      }

      setInterval(() => {
        obterDados(dht11Umidade, "dht11/umidade");
        obterDados(dht11Temperatura, "dht11/temperatura");
      }, 1000);
    </script>
  </body>
</html>
<script src="js/dashboard_body.js"></script>
<script src="js/script.js"></script>
<script src="js/funcoes.js"></script>